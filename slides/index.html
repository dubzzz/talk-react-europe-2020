<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>Detecting the unexpected in Web UI</title>

    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/reveal.css" />
    <link rel="stylesheet" href="css/theme/black.css" />

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/monokai.css" />

    <style>
      .reveal {
        font-size: 36px;
      }

      .reveal pre code {
        background: none;
      }

      .reveal h1,
      .reveal h2,
      .reveal h3,
      .reveal h4,
      .reveal h5,
      .reveal h6 {
        font-weight: normal;
        text-transform: none;
      }

      .reveal h1 + .more,
      .reveal h2 + .more,
      .reveal h3 + .more,
      .reveal h4 + .more,
      .reveal h5 + .more,
      .reveal h6 + .more {
        margin-top: -20px;
      }

      .reveal .more {
        color: #777872;
      }

      .reveal a,
      h3 {
        color: #00ccff !important;
        text-decoration: none;
      }
      .reveal a:hover,
      h2 {
        color: #008bff !important;
        text-decoration: none;
      }

      .reveal blockquote,
      .reveal p.quote {
        margin: 0;
        text-align: justify;
        font-style: italic;
        margin-right: 1em;
        margin-top: 20px;
        margin-bottom: 20px;
        padding-left: 1em;
        font-size: 0.9em;
        border-left: 1px navajowhite solid;
      }
      .reveal blockquote::before,
      .reveal p.quote::before {
        content: '\201C';
        font-size: 2em;
        float: left;
        color: white;
        margin-left: -1em;
      }

      .reveal p.quote-right {
        margin: 0;
        text-align: right;
        font-style: italic;
        margin-left: 1em;
        margin-top: 20px;
        margin-bottom: 20px;
        padding-right: 1em;
        font-size: 0.9em;
        border-right: 1px navajowhite solid;
      }
      .reveal p.quote-right::after {
        content: '\201C';
        font-size: 2em;
        float: right;
        color: white;
        margin-right: -1em;
      }

      em {
        color: #00ccff;
        font-style: normal;
        font-weight: normal;
      }

      li {
        color: #d3d3d3;
      }

      li.active,
      .left-menu > li:last-child,
      .left-menu > li:last-child > ul > li:last-child {
        color: #f37723;
      }

      .reveal ol {
        counter-reset: step-counter;
        list-style-type: none;
        margin: 0;
        padding: 0;
        width: 100%;
        text-align: center;
      }

      .reveal ol li {
        counter-increment: step-counter;
        margin-top: 10px;
        margin-bottom: 10px;
      }

      .reveal ol li:before {
        content: counter(step-counter, upper-roman);
        color: #f37723;
        float: left;
      }

      .reveal .vsmallnote {
        font-style: italic;
        font-size: 0.5em;
        color: #777872;
      }

      .flex {
        display: flex;
        flex-flow: row;
      }

      .no-margin {
        margin: none !important;
      }

      .left-column,
      .right-column {
        flex: 50%;
        text-align: left;
      }

      .left-padded {
        padding-left: 1em !important;
      }

      body {
        background: #000000;
        background-color: #000000;
      }

      .custom-collapse.fragment {
        max-height: 0;
        transform: scaleY(0%);
      }
      .custom-collapse.fragment.visible {
        max-height: 100px;
        transform: scaleY(100%);
        transition: max-height 2s ease-in, transform 2s ease-in;
      }

      .reveal .slides section .fragment.highlight-transparent {
        opacity: 1;
        visibility: visible;
      }
      .reveal .slides section .fragment.highlight-transparent.visible {
        opacity: 0.2;
        transition: opacity 0.3s ease-in;
      }

      .reveal .slides section.fullScreen {
        top: unset;
        padding: unset;
      }
      .reveal .slides section.fullScreen code {
        max-height: unset;
        max-width: unset;
      }

      /* It seems that there is a syntax highlighting bug when using data-line-numbers */
      section code[data-line-numbers]:not([data-fragment-index]),
      section code[data-line-numbers][data-fragment-index]:not(.current-fragment) {
        opacity: 0 !important;
        transition: all 0.2s ease-in;
      }
      section[data-fragment='-1'] code[data-line-numbers]:not([data-fragment-index]),
      section code[data-line-numbers][data-fragment-index].current-fragment {
        opacity: 1 !important;
        transition: all 0.2s ease-out;
      }

      @font-face {
        font-family: 'Virgil';
        src: url('./lib/font/FG_Virgil.woff2');
        /* src: url('https://excalidraw.com/FG_Virgil.woff2'); */
      }
      g.diag-white path,
      g.diag-user path,
      g.diag-call path,
      g.diag-answer path {
        stroke-width: 4px;
        fill: none;
      }
      g.diag-white text,
      g.diag-user text,
      g.diag-call text,
      g.diag-answer text {
        font-family: 'Virgil';
        font-size: 26px;
      }
      g.diag-white path {
        stroke: #ffffff;
      }
      g.diag-white text {
        fill: #ffffff;
      }
      g.diag-user path {
        stroke: #42affa;
      }
      g.diag-user text {
        fill: #42affa;
      }
      g.diag-call path {
        stroke: #364fc7;
      }
      g.diag-call text {
        fill: #364fc7;
      }
      g.diag-answer path {
        stroke: rgb(17, 183, 33);
      }
      g.diag-answer text {
        fill: rgb(17, 183, 33);
      }
    </style>

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement('link');
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName('head')[0].appendChild(link);
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <aside class="notes">
            Hey, hello everyone I'm Nicolas
            <br />Before introducing myself more precisely. <br />Let's first see what we are gonna discuss in this
            talk. <br />Today we will talk about "Detecting the unexpecting" and we will mostly focus on 'unexpected'
            behaviour that can happen in the front.
          </aside>
          <div>
            <img
              src="./images/react-europe.webp"
              alt="React-Europe"
              style="height: 128px; filter: invert(1); background: none; border: none; box-shadow: none;"
            />
          </div>
          <h1>Detecting the unexpected in Web UI</h1>
          <h3>Nicolas DUBIEN</h3>
          <p class="vsmallnote">
            React-Europe
          </p>
        </section>
        <section>
          <aside class="notes">
            But first, let's define what we can be 'unexpected'.
            <br />It happened to all of us (or at least it will): we've worked hard for days, months or maybe years.
            <br />We have highly covered the scenarii with tests (or maybe not). <br />But we are pretty confident that
            the project will be good enough and bulletproof. <br />But even with all those guards, one day it happened,
            a bug is reported...
          </aside>
          <h1>One day, it happened…</h1>
        </section>
        <section>
          <aside class="notes">
            And you feel a bit like this little dog. All your efforts ruined in a few seconds as you were just reaching
            the graal.
          </aside>
          <video controls width="100%" style="cursor: default;">
            <source src="./images/boom.webm" type="video/webm" />
          </video>
        </section>
        <section>
          <aside class="notes">
            There are many kind of 'unexpected' we can think about... They goes from security issues like this bug in
            Android In a nutshell with the scenario on the right side you were able to by-pass the lockscreen and open
            any Android device without knowing the password.
          </aside>
          <div style="display: grid; grid-template-columns: 30% auto; column-gap: 50px;">
            <div>
              <img
                src="./images/lockscreen-guardian.png"
                alt="Android issue with lockscreen"
                style="background: none; border: none; box-shadow: none;"
              />
            </div>
            <div>
              <p class="quote">
                0- Lock your screen
                <br />1- Open the EMERGENCY CALL window <br />2- Type a few characters <br />3- Select them and
                copy-paste until no longer highlights <br />4- Go back to the lockscreen <br />5- Open the camera
                <br />6- Open the notification drawer <br />7- Tap the Settings (gear) icon <br />8- Long-tap in the
                password field and paste the characters into it until it crashes 💥
              </p>
            </div>
          </div>
        </section>
        <section>
          <aside class="notes">
            Or more recently this one in facetime that allowed you to start the call before the person on the other side
            even accepted it
          </aside>
          <div style="display: grid; grid-template-columns: auto 30%; column-gap: 50px;">
            <div>
              <p class="quote-right">
                0- Start a FaceTime video call
                <br />1- Swipe up <br />2- Tap 'Add Person' before the call is answered <br />3- Add yourself - you'll
                be able to listen to the person on the other end before they accept the call 💥
              </p>
            </div>
            <div>
              <img
                src="./images/facetime-nyt.png"
                alt="FaceTime issue"
                style="background: none; border: none; box-shadow: none;"
              />
            </div>
          </div>
        </section>
        <section>
          <aside class="notes">
            This one is a bit different and need some more context.
            <br />I initially looked for an stay in Paris on a famous travel website. <br />Then I suddenly changed my
            mind. I live in Paris. So I moved for a stay in London. <br />And here were the suggestions. <br />BUT as I
            was browsing the suggestions, suddenly my first query went back.
            <br />
            <br />You might say: 'Ok, but this kind of bug is not really harmful...' <br />
            But let's imagine the same thing happens on the front of your bank or on the plaform you use to schedule
            your sprints, prepare your expenses... Just imagine, a UI glich telling you the operation was succesful
            while it tells you about another operation, a add to cart that adds another product, or a remove from cart
            that only removes visually from the cart...
            <br /><br />The common thing between all those bugs is that they are pretty difficult to detect And
            sometimes even impossible to reproduce or debug Either because the scenario is not well defined or
            understood Or because the bug is caused by bad network conditions, slow computers or random ordering of
            events...
          </aside>
          <img id="navigation-hell" alt="Navigation hell" src="./images/navigation-hell.gif" onclick="resetGif()" />
          <script>
            function resetGif() {
              document.getElementById('navigation-hell').setAttribute('src', '');
              document.getElementById('navigation-hell').setAttribute('src', './images/navigation-hell.gif');
            }
          </script>
        </section>
        <section>
          <aside class="notes">
            Today we will speak of a really rare subject in the front: Race Conditions
          </aside>
          <h2>Let's talk about race conditions</h2>
        </section>
        <section>
          <aside class="notes"></aside>
          <div>
            <img src="./images/me.jpg" style="border-radius: 50%; height: 128px;" />
          </div>
          <div>
            <h2>Nicolas DUBIEN</h2>
            <div style="margin-top: 48px;"></div>
            <div>
              <img
                src="./images/pigment.png"
                style="height: 64px; border: none; background: none; margin: 0px; box-shadow: none; filter: invert(1);"
              />
            </div>
            <div style="margin-top: 48px;"></div>
            <div style="color: #ffffff; vertical-align: middle;">
              <img src="./images/github-white.png" style="height: 32px; border: none; background: none; margin: 0px;" />
              dubzzz
            </div>
            <div style="color: #1da1f2; vertical-align: middle;">
              <img src="./images/twitter.png" style="height: 32px; border: none; background: none; margin: 0px;" />
              ndubien
            </div>
			<div style="color: #cb3837; vertical-align: middle;">
			  <img src="./images/npm.png" style="height: 32px; border: none; background: none; margin: 0px;" />
			  fast-check
			</div>
          </div>
        </section>
        <section>
          <aside class="notes">
            But what is a race condition? <br />As I first said, race conditions are often said to be reserved to the
            back. <br />But if you take a closer look to the definition on Wikipedia they are also clearly a real
            problem for us in the front.
          </aside>
          <h2>Race condition?</h2>
          <p class="quote">
            <span class="fragment highlight-transparent visible" data-fragment-index="1"
              >A race condition […] is the condition […] where the system's substantive behavior is dependent on the </span
            ><span class="fragment highlight-green visible" data-fragment-index="1">sequence</span
            ><span class="fragment highlight-transparent visible" data-fragment-index="1"> or timing </span
            ><span class="fragment highlight-green visible" data-fragment-index="1">of</span
            ><span class="fragment highlight-transparent visible" data-fragment-index="1"> other </span
            ><span class="fragment highlight-green visible" data-fragment-index="1">uncontrollable events</span
            ><span class="fragment highlight-transparent visible" data-fragment-index="1">.</span>
          </p>
          <p class="fragment custom-collapse">
            🤔 What about user inputs, API calls…?
          </p>
          <p class="vsmallnote">
            Source:
            <a href="https://en.wikipedia.org/wiki/Race_condition" target="_blank"
              >https://en.wikipedia.org/wiki/Race_condition</a
            >
          </p>
        </section>
        <section>
          <aside class="notes">
            Let's illustrate that with a simple diagram with arrows.
            <br />Let's suppose that each of those arrows corresponds to the response we get back from our back for
            instance. <br />Here we have two answers. They arrive in-order - ie the result for the first query we
            launched arrives before the one of the second query (which is hopefully most of the time the case).
            <br />Let's relabel them - thanks to our example on Paris and London: Results for Paris, Results for London.
          </aside>
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 926 520">
            <g class="diag-white">
              <g transform="translate(10 436) rotate(0 453 0)">
                <path d="M1 -2 C152 -2, 754 -1, 905 -0 M1 2 C152 3, 752 1, 904 1" />
                <path d="M872 9 C881 11, 895 1, 901 2 M876 12 C885 7, 894 5, 902 1" />
                <path d="M872 -11 C880 -2, 895 -5, 901 2 M876 -7 C885 -5, 894 -0, 902 1" />
              </g>
            </g>
            <g class="diag-white" transform="translate(844 466) rotate(0 34 22)">
              <text x="0" y="32">Time</text>
            </g>
            <g class="diag-user fragment" data-fragment-index="1">
              <g transform="translate(60 265) rotate(0 0 80)">
                <path d="M-1 -1 C-0 25, -0 134, -0 162 M0 -0 C-0 26, 2 133, 1 160" />
                <path d="M-10 133 C-9 138, -1 147, -1 160 M-9 130 C-3 139, -1 147, -0 159" />
                <path d="M10 133 C6 138, 10 147, -1 160 M11 130 C10 138, 6 146, -0 159" />
              </g>
            </g>
            <g class="diag-user fragment" data-fragment-index="1" transform="translate(-118 217) rotate(270 150 22)">
              <text x="0" y="32">User looks for stays in Paris</text>
            </g>
            <g class="diag-call fragment" data-fragment-index="2">
              <g transform="translate(83 426.148936170213) rotate(0 -1 -39)">
                <path d="M-1 -0 C-2 -13, -0 -62, -0 -74 M-2 -2 C-3 -15, 0 -64, 0 -77" />
                <path d="M7 -50 C6 -60, 2 -70, 2 -80 M8 -50 C6 -56, 6 -60, 1 -76" />
                <path d="M-12 -51 C-5 -61, -1 -70.551366474985, 2 -80 M-11 -51 C-8 -56, -3 -61, 1 -76" />
              </g>
            </g>
            <g class="diag-call fragment" data-fragment-index="2" transform="translate(-28 261) rotate(270 136.5 22)">
              <text x="0" y="32">API call for Paris</text>
            </g>
            <g class="diag-call fragment" data-fragment-index="2" transform="translate(-28 261) rotate(270 136.5 22)">
              <text x="248" y="32" style="filter: grayscale(0.9)">🗼</text>
            </g>
            <g class="diag-answer fragment" data-fragment-index="3">
              <g transform="translate(302 265) rotate(0 0 79)">
                <path d="M-0 0 C-1 27, -2 136, -2 163 M3 -4 C3 22, 3 135, 3 162" />
                <path d="M-6 131 C-4 146, -1 157, 5 165 M-6 133 C-3 141, -3 144, 1 160" />
                <path d="M14 132 C8 146, 4 157, 5 165 M14 133 C13 141, 8 144, 1 160" />
              </g>
            </g>
            <g class="diag-answer fragment" data-fragment-index="3" transform="translate(78 179) rotate(270 191 22)">
              <text x="0" y="32">Results for Paris</text>
            </g>
            <g class="diag-call fragment" data-fragment-index="3" transform="translate(78 179) rotate(270 191 22)">
              <text x="239" y="32" style="filter: grayscale(0.9)">🗼</text>
            </g>
            <g class="diag-user fragment" data-fragment-index="4" transform="translate(261 232) rotate(270 140 22)">
              <text x="0" y="32">User looks for stays in London</text>
            </g>
            <g class="diag-user fragment" data-fragment-index="4">
              <g transform="translate(431 264) rotate(0 -0 80)">
                <path d="M2 2 C2 30, -1 135, -1 162 M2 -2 C1 24, -2 135, -2 163" />
                <path d="M-8 135 C-13 145, -8 151, -3 166 M-11 136 C-10 144, -8 151, -1 162" />
                <path d="M11 135 C2 146, 2 152, -3 166 M9 136 C4 144, 2 151, -1 162" />
              </g>
            </g>
            <g class="diag-call fragment" data-fragment-index="5">
              <g transform="translate(451 425) rotate(0 -0 -36)">
                <path d="M0 1 C0 -10, 0 -62, 0 -75 M1 -4 C0 -17, -3 -61, -3 -72" />
                <path d="M10 -45 C5 -56, 3 -59, 0 -71 M9 -44 C5 -51, 3 -57, -4 -71" />
                <path d="M-10 -45 C-8 -55, -3 -59, 0 -71 M-10 -43 C-11 -51, -8 -57, -4 -71" />
              </g>
            </g>
            <g class="diag-call fragment" data-fragment-index="5" transform="translate(348 269) rotate(270 126 22)">
              <text x="0" y="32">API call for London 💂‍♂️</text>
            </g>
            <g class="diag-answer fragment" data-fragment-index="6">
              <g transform="translate(652 258) rotate(0 -1 83)">
                <path d="M0 2 C-0 29, -1 138, -2 165 M1 0 C0 27, -4 140, -4 167" />
                <path d="M-11 137 C-7 148, -7 162, -2 168 M-15 138 C-12 147, -10 154, -6 166" />
                <path d="M9 138 C4 149, -2 162, -2 168 M5 139 C1 148, -2 155, -6 166" />
              </g>
            </g>
            <g class="diag-answer fragment" data-fragment-index="6" transform="translate(439 186) rotate(270 181 22)">
              <text x="0" y="32">Results for London 💂‍♂️</text>
            </g>
            <g class="diag-answer fragment" data-fragment-index="7" transform="translate(78 179) rotate(270 191 22)">
              <text x="0" y="32" style="text-decoration: line-through; fill: darkred;">
                Results for Paris
              </text>
            </g>
            <g class="diag-answer fragment" data-fragment-index="7">
              <g transform="translate(302 265) rotate(0 0 79)">
                <path d="M-0 0 C-1 27, -2 136, -2 163 M3 -4 C3 22, 3 135, 3 162" style="stroke: darkred;" />
                <path d="M-6 131 C-4 146, -1 157, 5 165 M-6 133 C-3 141, -3 144, 1 160" style="stroke: darkred;" />
                <path d="M14 132 C8 146, 4 157, 5 165 M14 133 C13 141, 8 144, 1 160" style="stroke: darkred;" />
              </g>
            </g>
            <g class="diag-answer fragment" data-fragment-index="8" transform="translate(578 179) rotate(270 191 22)">
              <text x="0" y="32">
                Results for Paris
              </text>
            </g>
            <g class="diag-call fragment" data-fragment-index="8" transform="translate(578 179) rotate(270 191 22)">
              <text x="239" y="32" style="filter: grayscale(0.9)">🗼</text>
            </g>
            <g class="diag-answer fragment" data-fragment-index="8">
              <g transform="translate(802 265) rotate(0 0 79)">
                <path d="M-0 0 C-1 27, -2 136, -2 163 M3 -4 C3 22, 3 135, 3 162" />
                <path d="M-6 131 C-4 146, -1 157, 5 165 M-6 133 C-3 141, -3 144, 1 160" />
                <path d="M14 132 C8 146, 4 157, 5 165 M14 133 C13 141, 8 144, 1 160" />
              </g>
            </g>
          </svg>
        </section>
        <section>
          <aside class="notes">
            But fed from an API - like searches and suggestions in your favorite search engine (eg.: Google)
          </aside>
          <h2>Let's consider a simple example</h2>
          <h3 class="fragment custom-collapse">
            An autocomplete field in React
          </h3>
        </section>
        <section>
          <aside class="notes">
            Just to be aligned with all of you, here is what an autocomplete can look like
          </aside>
          <img src="./images/autocomplete-ok.gif" style="border: none; background: none; margin: 0px;" />
        </section>
        <section class="fullScreen">
          <aside class="notes"></aside>
          <pre><code class="hljs" data-trim data-line-numbers="1-28|5,21-24|8,16|9-12|2,13-15|6,10,14,25">
			import React, { useEffect, useState } from 'react';
			import { suggestionsFor } from './Api';
			
			export default function Autocomplete() {
			  const [query, setQuery] = useState('');
			  const [suggestions, setSuggestions] = useState([]);
			
			  useEffect(() =&gt; {
			    if (query === '') {
			      setSuggestions([]);
			      return;
			    }
			    suggestionsFor(query).then((suggestions) =&gt; {
			      setSuggestions(suggestions);
			    });
			  }, [query]);
			
			  return (
			    &lt;div&gt;
			      &lt;label htmlFor="autocomplete-field"&gt;Select a package: &lt;/label&gt;
			      &lt;input
			        id="autocomplete-field"
			        value={query}
			        onChange={(e) =&gt; setQuery(e.target.value)} /&gt;
			      &lt;ul&gt;{suggestions.map((s) =&gt; &lt;li key={s}=&gt;{s}&lt;/li&gt;)}&lt;/ul&gt;
			    &lt;/div&gt;
			  );
			}			
		  </code></pre>
        </section>
        <section>
		  <aside class="notes"></aside>
		  <h3>How to test it?</h3>
		  <ul>
			<li class="fragment">Mock the api - using <code>jest.mock</code></li>
			<li class="fragment">Simulate an user typing a search query - using <code>@testing-library/user-event</code></li>
			<li class="fragment">Check that the suggestions are correct</li>
		  </ul>
        </section>
        <section class="fullScreen">
          <aside class="notes"></aside>
          <pre><code class="hljs javascript" data-trim data-line-numbers="1-24|2-8|10-17|19-23">
test('should autocomplete queries', async () =&gt; {
  // Arrange
  const allResults = ['apple', 'banana', 'orange', 'pineapple'];
  suggestionsFor.mockImplementation(async (query) =&gt; {
    return allResults.filter((r) =&gt; r.includes(query));
  });
  const userQuery = 'nan';
  const expectedResults = ['banana'];
  
  // Act
  const { getByRole, queryAllByRole } = render(&lt;Autocomplete /&gt;);
  await act(async () =&gt; {
    await userEvent.type(
	  getByRole('textbox'),
	  userQuery,
	  { allAtOnce: false, delay: 1 });
  });
  
  // Assert
  const displayedSuggestions = queryAllByRole('listitem')
      .map((el) =&gt; el.textContent);
  expect(displayedSuggestions).toEqual(expectedResults);
  expect(suggestionsFor).toHaveBeenCalledTimes(userQuery.length);
});
		  </code></pre>
        </section>
        <section>
		  <aside class="notes"></aside>
		  <h3>Test status: <b><span class="fragment" style="color:green">√</span></h3></b>
		  <p class="fragment">🤔 What?</p>
        </section>
        <section>
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 926 520">
            <g class="diag-white">
              <g transform="translate(10 436) rotate(0 453 0)">
                <path d="M1 -2 C152 -2, 754 -1, 905 -0 M1 2 C152 3, 752 1, 904 1" />
                <path d="M872 9 C881 11, 895 1, 901 2 M876 12 C885 7, 894 5, 902 1" />
                <path d="M872 -11 C880 -2, 895 -5, 901 2 M876 -7 C885 -5, 894 -0, 902 1" />
              </g>
            </g>
            <g class="diag-white" transform="translate(844 466) rotate(0 34 22)">
              <text x="0" y="32">Time</text>
            </g>
            <g class="diag-user fragment" data-fragment-index="1">
              <g transform="translate(60 265) rotate(0 0 80)">
                <path d="M-1 -1 C-0 25, -0 134, -0 162 M0 -0 C-0 26, 2 133, 1 160" />
                <path d="M-10 133 C-9 138, -1 147, -1 160 M-9 130 C-3 139, -1 147, -0 159" />
                <path d="M10 133 C6 138, 10 147, -1 160 M11 130 C10 138, 6 146, -0 159" />
              </g>
            </g>
            <g class="diag-user fragment" data-fragment-index="1" transform="translate(-118 217) rotate(270 150 22)">
              <text x="0" y="32">Updating query to "n"</text>
            </g>
            <g class="diag-call fragment" data-fragment-index="2">
              <g transform="translate(83 426.148936170213) rotate(0 -1 -39)">
                <path d="M-1 -0 C-2 -13, -0 -62, -0 -74 M-2 -2 C-3 -15, 0 -64, 0 -77" />
                <path d="M7 -50 C6 -60, 2 -70, 2 -80 M8 -50 C6 -56, 6 -60, 1 -76" />
                <path d="M-12 -51 C-5 -61, -1 -70.551366474985, 2 -80 M-11 -51 C-8 -56, -3 -61, 1 -76" />
              </g>
            </g>
            <g class="diag-call fragment" data-fragment-index="2" transform="translate(-28 261) rotate(270 136.5 22)">
              <text x="0" y="32">API call for "n"</text>
            </g>
            <g class="diag-user fragment" data-fragment-index="3" transform="translate(12 232) rotate(270 140 22)">
              <text x="0" y="32">Updating query to "na"</text>
            </g>
            <g class="diag-user fragment" data-fragment-index="3">
              <g transform="translate(190 264) rotate(0 -0 80)">
                <path d="M2 2 C2 30, -1 135, -1 162 M2 -2 C1 24, -2 135, -2 163" />
                <path d="M-8 135 C-13 145, -8 151, -3 166 M-11 136 C-10 144, -8 151, -1 162" />
                <path d="M11 135 C2 146, 2 152, -3 166 M9 136 C4 144, 2 151, -1 162" />
              </g>
            </g>
            <g class="diag-call fragment" data-fragment-index="4">
              <g transform="translate(213 426.148936170213) rotate(0 -1 -39)">
                <path d="M-1 -0 C-2 -13, -0 -62, -0 -74 M-2 -2 C-3 -15, 0 -64, 0 -77" />
                <path d="M7 -50 C6 -60, 2 -70, 2 -80 M8 -50 C6 -56, 6 -60, 1 -76" />
                <path d="M-12 -51 C-5 -61, -1 -70.551366474985, 2 -80 M-11 -51 C-8 -56, -3 -61, 1 -76" />
              </g>
            </g>
            <g class="diag-call fragment" data-fragment-index="4" transform="translate(102 261) rotate(270 136.5 22)">
              <text x="0" y="32">API call for "na"</text>
            </g>
            <g class="diag-user fragment" data-fragment-index="5" transform="translate(141 232) rotate(270 140 22)">
              <text x="0" y="32">Updating query to "nan"</text>
            </g>
            <g class="diag-user fragment" data-fragment-index="5">
              <g transform="translate(311 264) rotate(0 -0 80)">
                <path d="M2 2 C2 30, -1 135, -1 162 M2 -2 C1 24, -2 135, -2 163" />
                <path d="M-8 135 C-13 145, -8 151, -3 166 M-11 136 C-10 144, -8 151, -1 162" />
                <path d="M11 135 C2 146, 2 152, -3 166 M9 136 C4 144, 2 151, -1 162" />
              </g>
            </g>
            <g class="diag-call fragment" data-fragment-index="6">
              <g transform="translate(331 425) rotate(0 -0 -36)">
                <path d="M0 1 C0 -10, 0 -62, 0 -75 M1 -4 C0 -17, -3 -61, -3 -72" />
                <path d="M10 -45 C5 -56, 3 -59, 0 -71 M9 -44 C5 -51, 3 -57, -4 -71" />
                <path d="M-10 -45 C-8 -55, -3 -59, 0 -71 M-10 -43 C-11 -51, -8 -57, -4 -71" />
              </g>
            </g>
            <g class="diag-call fragment" data-fragment-index="6" transform="translate(228 269) rotate(270 126 22)">
              <text x="0" y="32">API call for "nan"</text>
            </g>
            <g class="diag-answer fragment" data-fragment-index="7">
              <g transform="translate(502 265) rotate(0 0 79)">
                <path d="M-0 0 C-1 27, -2 136, -2 163 M3 -4 C3 22, 3 135, 3 162" />
                <path d="M-6 131 C-4 146, -1 157, 5 165 M-6 133 C-3 141, -3 144, 1 160" />
                <path d="M14 132 C8 146, 4 157, 5 165 M14 133 C13 141, 8 144, 1 160" />
              </g>
            </g>
            <g class="diag-answer fragment" data-fragment-index="7" transform="translate(278 179) rotate(270 191 22)">
              <text x="0" y="32">Results for "na" [🍌]</text>
            </g>
            <g class="diag-answer fragment" data-fragment-index="8">
              <g transform="translate(652 258) rotate(0 -1 83)">
                <path d="M0 2 C-0 29, -1 138, -2 165 M1 0 C0 27, -4 140, -4 167" />
                <path d="M-11 137 C-7 148, -7 162, -2 168 M-15 138 C-12 147, -10 154, -6 166" />
                <path d="M9 138 C4 149, -2 162, -2 168 M5 139 C1 148, -2 155, -6 166" />
              </g>
            </g>
            <g class="diag-answer fragment" data-fragment-index="8" transform="translate(439 186) rotate(270 181 22)">
              <text x="0" y="32">Results for "nan" [🍌]</text>
            </g>
            <g class="diag-answer fragment" data-fragment-index="9">
              <g transform="translate(802 258) rotate(0 -1 83)">
                <path d="M0 2 C-0 29, -1 138, -2 165 M1 0 C0 27, -4 140, -4 167" />
                <path d="M-11 137 C-7 148, -7 162, -2 168 M-15 138 C-12 147, -10 154, -6 166" />
                <path d="M9 138 C4 149, -2 162, -2 168 M5 139 C1 148, -2 155, -6 166" />
              </g>
            </g>
            <g class="diag-answer fragment" data-fragment-index="9" transform="translate(589 186) rotate(270 181 22)">
              <text x="0" y="32">Results for "n" [🍌/🍊/🍍]</text>
            </g>
          </svg>
        </section>
        <section>
		  <aside class="notes"></aside>
          <img src="./images/autocomplete-bug-screenshot.png" style="border: none; background: none; margin: 0px;" />
        </section>
        <section>
		  <aside class="notes"></aside>
          <img src="./images/autocomplete-bug.gif" style="border: none; background: none; margin: 0px;" />
		</section>
		<section>
			<aside class="notes"></aside>
			<h3>What is missing in our test?</h3>
			<p class="fragment">Async mocks are always resolved in order</p>
		</section>
		<section>
			<aside class="notes"></aside>
			<h3>Let's test it using <code>fast-check</code></h3>
			<img class="fragment" src="./images/logo.png" style="border: none; background: none; margin: 0px;" />
		</section>
		<section class="fullScreen">
			<aside class="notes"></aside>
			<pre><code class="hljs javascript" data-trim data-line-numbers="1-29|1,4-6,8,10-19,21-26,29|2,3,27,28|7-9|20|2,3,27,28,7-9,20">
test('should autocomplete queries', async () =&gt; {
  await fc.assert(
    fc.asyncProperty(fc.scheduler({ act }), async (s) =&gt; {
      // Arrange
      const allResults = ['apple', 'banana', 'orange', 'pineapple'];
      suggestionsFor.mockImplementation(
        s.scheduleFunction(async (query) =&gt; {
          return allResults.filter((r) =&gt; r.includes(query));
        })
      );
      const userQuery = 'nan';
      const expectedResults = ['banana'];
      
      // Act
      const { getByRole, queryAllByRole } = render(&lt;Autocomplete /&gt;);
      await act(async () =&gt; {
        await userEvent.type(getByRole('textbox'),
          userQuery, { allAtOnce: false, delay: 1 });
      });
      await s.waitAll();
      
      // Assert
      const displayedSuggestions = queryAllByRole('listitem')
          .map((el) =&gt; el.textContent);
      expect(displayedSuggestions).toEqual(expectedResults);
      expect(suggestionsFor).toHaveBeenCalledTimes(userQuery.length);
    }).beforeEach(() =&gt; {/* same as beforeEach */})
  );
});
			</code></pre>
		</section>
        <section>
		  <aside class="notes"></aside>
		  <h3>Test status: <b><span class="fragment" style="color:red">×</span></h3></b>
        </section>
		<section class="fullScreen">
			<aside class="notes"></aside>
			<pre><code class="hljs text" data-trim data-line-numbers="1-25|3-14|11,12|8,9|5,6|5-12,18-25">
Property failed after 3 tests
{ seed: 1134225087, path: "2", endOnFailure: true }
Counterexample: [Scheduler`

-> [task#3] function::("nan")
	resolved with value ["banana"]

-> [task#2] function::("na")
	resolved with value ["banana"]

-> [task#1] function::("n")
	resolved with value ["banana","orange","pineapple"]

`]
Shrunk 0 time(s)
Got error: Error: expect(received).toEqual(expected) // deep equality

- Expected
+ Received

  Array [
      "banana",
+     "orange",
+     "pineapple",
  ]
			</code></pre>
		</section>
		<section class="fullScreen" data-transition="slide-in fade-out">
			<aside class="notes"></aside>
			<pre><code class="hljs javascript" data-trim data-line-numbers="1-29|12">
test('should autocomplete queries', async () =&gt; {
  await fc.assert(
    fc.asyncProperty(fc.scheduler({ act }), async (s) =&gt; {
      // Arrange
      const allResults = ['apple', 'banana', 'orange', 'pineapple'];
      suggestionsFor.mockImplementation(
        s.scheduleFunction(async (query) =&gt; {
          return allResults.filter((r) =&gt; r.includes(query));
        })
      );
      const userQuery = 'nan';
      const expectedResults = ['banana'];
      
      // Act
      const { getByRole, queryAllByRole } = render(&lt;Autocomplete /&gt;);
      await act(async () =&gt; {
        await userEvent.type(getByRole('textbox'),
          userQuery, { allAtOnce: false, delay: 1 });
      });
      await s.waitAll();
      
      // Assert
      const displayedSuggestions = queryAllByRole('listitem')
          .map((el) =&gt; el.textContent);
      expect(displayedSuggestions).toEqual(expectedResults);
      expect(suggestionsFor).toHaveBeenCalledTimes(userQuery.length);
    }).beforeEach(() =&gt; {/* same as beforeEach */})
  );
});
			</code></pre>
		</section>
		<section class="fullScreen" data-transition="fade-in fade-out">
			<aside class="notes"></aside>
			<pre><code class="hljs javascript" data-trim data-line-numbers="12,13|11">
test('should autocomplete queries', async () =&gt; {
  await fc.assert(
    fc.asyncProperty(fc.scheduler({ act }), async (s) =&gt; {
      // Arrange
      const allResults = ['apple', 'banana', 'orange', 'pineapple'];
      suggestionsFor.mockImplementation(
        s.scheduleFunction(async (query) =&gt; {
          return allResults.filter((r) =&gt; r.includes(query));
        })
      );
      const userQuery = 'nan';
      const expectedResults = allResults
          .filter((r) =&gt; r.includes(userQuery));
      
      // Act
      const { getByRole, queryAllByRole } = render(&lt;Autocomplete /&gt;);
      await act(async () =&gt; {
        await userEvent.type(getByRole('textbox'),
          userQuery, { allAtOnce: false, delay: 1 });
      });
      await s.waitAll();
      
      // Assert
      const displayedSuggestions = queryAllByRole('listitem')
          .map((el) =&gt; el.textContent);
      expect(displayedSuggestions).toEqual(expectedResults);
      expect(suggestionsFor).toHaveBeenCalledTimes(userQuery.length);
    }).beforeEach(() =&gt; {/* same as beforeEach */})
  );
});
			</code></pre>
		</section>
		<section class="fullScreen" data-transition="fade-in fade-out">
			<aside class="notes"></aside>
			<pre><code class="hljs javascript" data-trim data-line-numbers="4,5|7">
test('should autocomplete queries', async () =&gt; {
  await fc.assert(
    fc.asyncProperty(fc.scheduler({ act })
                   , fc.string(1, 10)
                   , async (s, userQuery) =&gt; {
      // Arrange
      const allResults = ['apple', 'banana', 'orange', 'pineapple'];
      suggestionsFor.mockImplementation(
        s.scheduleFunction(async (query) =&gt; {
          return allResults.filter((r) =&gt; r.includes(query));
        })
      );
      const expectedResults = allResults
          .filter((r) =&gt; r.includes(userQuery));
      
      // Act
      const { getByRole, queryAllByRole } = render(&lt;Autocomplete /&gt;);
      await act(async () =&gt; {
        await userEvent.type(getByRole('textbox'),
          userQuery, { allAtOnce: false, delay: 1 });
      });
      await s.waitAll();
      
      // Assert
      const displayedSuggestions = queryAllByRole('listitem')
          .map((el) =&gt; el.textContent);
      expect(displayedSuggestions).toEqual(expectedResults);
      expect(suggestionsFor).toHaveBeenCalledTimes(userQuery.length);
    }).beforeEach(() =&gt; {/* same as beforeEach */})
  );
});
			</code></pre>
		</section>
		<section class="fullScreen" data-transition="fade-in fade-out">
			<aside class="notes"></aside>
			<pre><code class="hljs javascript" data-trim data-line-numbers="4,6|18-21">
test('should autocomplete queries', async () =&gt; {
  await fc.assert(
	fc.asyncProperty(fc.scheduler({ act })
                   , fc.set(fc.string())
                   , fc.string(1, 10)
                   , async (s, allResults, userQuery) =&gt; {
      // Arrange
      suggestionsFor.mockImplementation(
        s.scheduleFunction(async (query) =&gt; {
          return allResults.filter((r) =&gt; r.includes(query));
        })
      );
      const expectedResults = allResults
          .filter((r) =&gt; r.includes(userQuery));
      
      // Act
      const { getByRole, queryAllByRole } = render(&lt;Autocomplete /&gt;);
      await act(async () =&gt; {
        await userEvent.type(getByRole('textbox'),
          userQuery, { allAtOnce: false, delay: 1 });
      });
      await s.waitAll();
      
      // Assert
      const displayedSuggestions = queryAllByRole('listitem')
          .map((el) =&gt; el.textContent);
      expect(displayedSuggestions).toEqual(expectedResults);
      expect(suggestionsFor).toHaveBeenCalledTimes(userQuery.length);
    }).beforeEach(() =&gt; {/* same as beforeEach */})
  );
});
			</code></pre>
		</section>
		<section class="fullScreen" data-transition="fade-in slide-out">
			<aside class="notes"></aside>
			<pre><code class="hljs javascript" data-trim data-line-numbers="18-25|1-200">
test('should autocomplete queries', async () =&gt; {
  await fc.assert(
	fc.asyncProperty(fc.scheduler({ act })
                   , fc.set(fc.string())
                   , fc.string(1, 10)
                   , async (s, allResults, userQuery) =&gt; {
      // Arrange
      suggestionsFor.mockImplementation(
        s.scheduleFunction(async (query) =&gt; {
          return allResults.filter((r) =&gt; r.includes(query));
        })
      );
      const expectedResults = allResults
          .filter((r) =&gt; r.includes(userQuery));
      
      // Act
      const { getByRole, queryAllByRole } = render(&lt;Autocomplete /&gt;);
      s.scheduleSequence(
        [...userQuery].map((c, i) =&gt; ({
          label: `Typing "${c}"`,
          builder: () =&gt; userEvent.type(getByRole('textbox'),
                                        userQuery.substr(0, i+1),
                                        { allAtOnce: true }),
        }))
      );
      await s.waitAll();
      
      // Assert
      const displayedSuggestions = queryAllByRole('listitem')
          .map((el) =&gt; el.textContent);
      expect(displayedSuggestions).toEqual(expectedResults);
      expect(suggestionsFor).toHaveBeenCalledTimes(userQuery.length);
    }).beforeEach(() =&gt; {/* same as beforeEach */})
  );
});
			</code></pre>
		</section>
		<section class="fullScreen">
			<aside class="notes"></aside>
			<pre><code class="hljs text" data-trim>
Property failed after 2 tests
{ seed: -1614603237, path: "1:[...]:2", endOnFailure: true }

Counterexample: [
  Scheduler`
    -> [task#1] sequence::Typing "A" resolved
    -> [task#3] sequence::Typing "B" resolved
    -> [task#4] function::("AB") resolved with value []
    -> [task#2] function::("A") resolved with value ["A"]
  `,["A"],"AB"]

Shrunk 15 time(s)
Got error: Error: expect(received).toEqual(expected) // deep equality

- Expected
+ Received

- Array []
+ Array [
+   "A",
+ ]
			</code></pre>
		</section>
        <section>
          <h2>Questions?</h2>
          <div style="margin-top: 48px;"></div>
          <div>
            <img
              src="./images/logo.png"
              style="border: none; background: none; margin: 0px; box-shadow: none;"
            />
          </div>
          <div style="margin-top: 48px;"></div>
          <div style="color: #ffffff; vertical-align: middle;">
            <img src="./images/github-white.png" style="height: 32px; border: none; background: none; margin: 0px;" />
            dubzzz
          </div>
          <div style="color: #1da1f2; vertical-align: middle;">
            <img src="./images/twitter.png" style="height: 32px; border: none; background: none; margin: 0px;" />
            ndubien
          </div>
        </section>
      </div>
    </div>
    <div
      style="
        position: fixed;
        z-index: 9999;
        left: 1em;
        bottom: 1em;
        color: #ffffff;
        font-size: 1.5em;
        font-family: 'Source Sans Pro', Helvetica, sans-serif;
      "
    >
      <div style="color: #ffffff; vertical-align: middle;">
        <img src="./images/github-white.png" style="height: 16px; border: none; background: none; margin: 0px;" />
        dubzzz
      </div>
      <div style="color: #1da1f2; vertical-align: middle;">
        <img src="./images/twitter.png" style="height: 16px; border: none; background: none; margin: 0px;" />
        ndubien
      </div>
      <div style="color: #cb3837; vertical-align: middle;">
        <img src="./images/npm.png" style="width: 16px; border: none; background: none; margin: 0px;" />
        fast-check
      </div>
    </div>

    <script src="js/reveal.js"></script>

    <script>
      // More info about config & dependencies:
      // - https://github.com/hakimel/reveal.js#configuration
      // - https://github.com/hakimel/reveal.js#dependencies
      Reveal.initialize({
        hash: true,
        slideNumber: true,
        fragmentInURL: true,
        totalTime: 25 * 60,
        dependencies: [
          { src: 'plugin/markdown/marked.js' },
          { src: 'plugin/markdown/markdown.js' },
          { src: 'plugin/highlight/highlight.js' },
          { src: 'plugin/notes/notes.js', async: true },
        ],
      });
    </script>
  </body>
</html>
